<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-MXJBGBBZ');
    </script>
    <!-- End Google Tag Manager -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Comparativo de Câmeras Canon" />
    <meta name="keywords" content="Comparativo de Câmeras, câmeras, DSLR, Mirrorless, tecnologias, fotografia" />
    <meta name="author" content="Canon do Brasil - Comparativo de Câmeras" />
    <title>Câmeras</title>
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
    <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/library.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image@2.6.0/dist/dom-to-image.min.js"></script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MXJBGBBZ" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header>
      <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/canon-logo.svg" alt="Logo da Canon" onclick="refresh()" class="clicable" />
    </header>

    <section id="logo-container">
      <div class="container-fluid">
        <div class="row" style="flex-direction: column; align-items: center">
          <div class="col-12 header-grid">
            <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/comparativo-logo.png" style="width: 350px; max-width: 100%; height: auto" alt="Logo comparativo de câmeras" onclick="refresh()" class="clicable" />
          </div>
        </div>
      </div>
    </section>
    <main>
      <div class="container-fluid">
        <div class="step1">
          <div class="row">
            <div class="col-12 flex-center">
              <div class="box-information-desk">
                <div class="box-information-text">
                  <h1>Descubra qual é a Canon Perfeita para você!</h1>
                  <h2>Nossa ferramenta compara as especificações de diferentes câmeras fotográficas, te ajudando a escolher o equipamento ideal.</h2>
                  <h2>Para fotógrafos e videomakers, profissionais ou iniciantes, nosso comparativo analisa diversas especificações técnicas das nossas câmeras, como por exemplo a resolução, foco, estabilização e dentre outras, garantindo que você encontre a câmera Canon certa para o que você precisa.</h2>
                  <div class="button" onclick="nextStep2()">Vamos começar ></div>
                </div>
              </div>
              <div class="box-information-mobile">
                <div class="box-information-imagem-mobile">
                  <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/background-info-mobile.jpg" alt="Imagem de fundo com um rapaz mostrando uma camera a uma mulher" width="100%" loading="lazy"/>
                </div>
                <div class="box-information-text-mobile">
                  <h1>Descubra qual é a Canon Perfeita para você!</h1>
                  <h2>Nossa ferramenta compara instantaneamente as especificações de diferentes câmeras fotográficas, te ajudando a escolher o equipamento ideal.</h2>
                  <h2>Para fotógrafos e videomakers, profissionais ou iniciantes, nosso comparativo analisa diversas especificações técnicas das nossas câmeras, como por exemplo a resolução, foco, estabilização e dentre outras, garantindo que você encontre a câmera Canon certa para o que você precisa.</h2>
                  <div class="button" onclick="nextStep2()">Vamos começar ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="step2 hide">
          <div class="row">
            <div class="col-12 flex-center">
              <div class="box-information">
                <div class="box-information-header">
                  <h1>Selecione os modelos que deseja comparar</h1>
                </div>
                <form>
                  <div class="box-information-compare">
                    <div class="compare-itens">
                      <div class="item-box">
                        <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/camera-silhueta.png" alt="Silhueta da camera" class="bg-silhueta camera-item-1" />
                        <input type="text" class="input-item-name camera1" placeholder="Pesquisar" onkeyup="changeCamera1()" />
                      </div>
                      <div class="item-box">
                        <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/camera-silhueta.png" alt="Silhueta da camera" class="bg-silhueta camera-item-2" />
                        <input type="text" class="input-item-name camera2" placeholder="Pesquisar" onkeyup="changeCamera2()" />
                      </div>
                      <div class="item-box">
                        <img src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/image/camera-silhueta.png" alt="Silhueta da camera" class="bg-silhueta camera-item-3" />
                        <input type="text" class="input-item-name camera3" placeholder="Pesquisar" onkeyup="changeCamera3()" />
                      </div>
                    </div>
                    <div class="botoes">
                      <div class="button" onclick="refresh()">< Voltar</div>
                      <div class="button" onclick="searchCameras()">Ver resultado ></div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="step3 hide">
          <div class="row flex-center">
            <div class="col-12">
              <div class="box-information">
                <div class="box-information-header">
                  <h1>Veja o comparativo das Câmeras:</h1>
                </div>
                <div class="box-information-compare">
                  <table id="camera-table"></table>
                </div>
              </div>
              <div class="botoes">
                <div class="button" onclick="refresh()">Refazer ></div>
                <button class="button" id="generate-pdf">Gerar PDF</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer id="footer">
      <div class="container">
        <div class="row row-flex">
          <div class="col-12 footer-grid">
            <div class="footer-info">
              <p class="footer-text"></p>
              <a href="https://www.privacidade.com.br/portal-de-privacidade?token=9f891d946ed5adada7f6b000eb0bcdd8" target="_blank"> LGPD - Exerça seus direitos </a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <div id="loadingModal" class="modal">
      <div class="modal-content">
        <div class="loader"></div>
        <p>Gerando PDF, por favor aguarde...</p>
      </div>
    </div>
    <div class="scripts-box">
      <script>
        const camera1Input = document.querySelector('.camera1');
        const camera2Input = document.querySelector('.camera2');
        const camera3Input = document.querySelector('.camera3');
        const submitButton = document.querySelector('.button');

        // const refresh = () => {
        //   window.location.replace(location.pathname);
        // };

        function updateIframeSrc() {
          const params = new URLSearchParams(window.location.search);
          const iframe = document.getElementById('camera-comparator');
          const baseUrl = 'https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/index.html'; // Substitua pela URL do seu index.html
          iframe.src = `${baseUrl}?${params.toString()}`;
        }

        const refresh = () => {
          window.history.pushState({}, '', window.location.pathname);
          window.location.reload();
        };

        const showLoadingModal = () => {
          document.getElementById('loadingModal').style.display = 'block';
        };

        const hideLoadingModal = () => {
          document.getElementById('loadingModal').style.display = 'none';
        };
      </script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/camera-handler.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/url-handler.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/main.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/table-handler.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/drag-scroll.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/page-load.js"></script>
      <script src="https://extranet.canon.com.br/ecommerce/_files/comparativo-camera/js/fixed-rows.js"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
      <script>
        document.getElementById('generate-pdf').addEventListener('click', async () => {
          try {
            showLoadingModal();
            // Show loading
            const button = document.getElementById('generate-pdf');
            button.textContent = 'Gerando PDF...';
            button.disabled = true;

            // Ensure the element is visible
            const element = document.querySelector('.step3');
            element.classList.remove('hide');

            // Wait for a short time to ensure the element is fully rendered
            await new Promise((resolve) => setTimeout(resolve, 500));

            // Log element dimensions
            const rect = element.getBoundingClientRect();

            // Configure html2canvas
            const canvas = await html2canvas(element, {
              scale: 2,
              useCORS: true,
              logging: true,
              backgroundColor: '#ffffff',
              windowWidth: 1300,
            });

            // Create PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
              orientation: 'portrait',
              unit: 'mm',
              format: 'a4',
            });

            // A4 dimensions (mm)
            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 10;
            const usablePageHeight = pageHeight - margin * 2;

            // Calculate dimensions maintaining aspect ratio
            const imgWidth = pageWidth - margin * 2;

            // Process each row of the table
            const rows = element.querySelectorAll('tr');
            let currentPageHeight = margin;

            for (let row of rows) {
              const rowCanvas = await html2canvas(row, {
                scale: 2,
                useCORS: true,
                logging: true,
                backgroundColor: '#ffffff',
                windowWidth: 1300,
              });

              const rowHeight = (rowCanvas.height * imgWidth) / rowCanvas.width;

              // Check if the row fits in the current page
              if (currentPageHeight + rowHeight > usablePageHeight) {
                pdf.addPage();
                currentPageHeight = margin;
              }

              const rowImgData = rowCanvas.toDataURL('image/jpeg', 1.0);
              pdf.addImage(rowImgData, 'JPEG', margin, currentPageHeight, imgWidth, rowHeight);

              currentPageHeight += rowHeight;
            }

            // Save PDF
            pdf.save('comparativo-cameras.pdf');
          } catch (error) {
            console.error('Erro ao gerar PDF:', error);
            alert('Erro ao gerar PDF. Por favor, tente novamente.');
          } finally {
            hideLoadingModal();
            const button = document.getElementById('generate-pdf');
            button.textContent = 'Gerar PDF';
            button.disabled = false;
          }
        });
      </script>
      <script>
        function notifyParentOfURLChange() {
          const newURL = window.location.href;
          window.parent.postMessage(newURL, 'https://cloud.digital.canon.com.br');
        }

        window.addEventListener('popstate', notifyParentOfURLChange);
        window.addEventListener('pushstate', notifyParentOfURLChange);
        window.addEventListener('replacestate', notifyParentOfURLChange);

        (function (history) {
          const pushState = history.pushState;
          const replaceState = history.replaceState;

          history.pushState = function (state) {
            if (typeof history.onpushstate == 'function') {
              history.onpushstate({ state: state });
            }
            const result = pushState.apply(history, arguments);
            window.dispatchEvent(new Event('pushstate'));
            return result;
          };

          history.replaceState = function (state) {
            if (typeof history.onreplacestate == 'function') {
              history.onreplacestate({ state: state });
            }
            const result = replaceState.apply(history, arguments);
            window.dispatchEvent(new Event('replacestate'));
            return result;
          };
        })(window.history);
      </script>
      <script>
        const dataAtual = new Date();
        const anoAtual = dataAtual.getFullYear();
        document.querySelector('.footer-text').innerHTML = `CANON DO BRASIL - ${anoAtual}`;
      </script>

      <script>
        // Analytics Events Implementation
        const originalNextStep2 = window.nextStep2;
        window.nextStep2 = (event) => {
          window.dataLayer.push({
            event: 'view_step',
            step_name: 'selection',
          });
          originalNextStep2(event);
        };

        // Modify changeCamera function
        const originalChangeCamera = window.changeCamera;
        window.changeCamera = (inputNumber) => {
          const input = document.querySelector(`.camera${inputNumber}`);
          const selectedCamera = findCameraByName(input.value);

          if (selectedCamera) {
            window.dataLayer.push({
              event: 'select_camera',
              camera_model: selectedCamera.Modelo,
              position: inputNumber,
            });
          }
          originalChangeCamera(inputNumber);
        };

        // Modify searchCameras function
        const originalSearchCameras = window.searchCameras;
        window.searchCameras = () => {
          if (cameras && cameras.length >= 2) {
            window.dataLayer.push({
              event: 'compare_products',
              products: cameras.map((c) => ({
                item_name: c.Modelo,
              })),
              number_of_items: cameras.length,
            });
          }
          originalSearchCameras();
        };

        document.addEventListener('DOMContentLoaded', () => {
          window.dataLayer.push({
            event: 'view_step',
            step_name: 'start',
          });

          document.body.addEventListener('click', (e) => {
            if (e.target.classList.contains('buy-button') && !e.target.classList.contains('disabled')) {
              const modelCell = e.target.closest('.model-cell');
              if (modelCell) {
                const model = modelCell.querySelector('.model-name').textContent;
                window.dataLayer.push({
                  event: 'begin_checkout',
                  product_name: model,
                });
              }
            }

            if (e.target.matches('a[href^="http"]') && e.target.textContent === 'Acessar Manual') {
              const row = e.target.closest('tr');
              if (row) {
                window.dataLayer.push({
                  event: 'download_manual',
                  camera_model: row.querySelector('.cell-spec').textContent,
                });
              }
            }
          });

          const pdfButton = document.getElementById('generate-pdf');
          if (pdfButton) {
            pdfButton.addEventListener('click', () => {
              if (cameras && cameras.length) {
                window.dataLayer.push({
                  event: 'download_pdf',
                  camera_models: cameras.map((c) => c.Modelo).join(','),
                });
              }
            });
          }
        });

        const originalAlert = window.alert;
        window.alert = (message) => {
          window.dataLayer.push({
            event: 'user_error',
            error_message: message,
          });
          originalAlert(message);
        };
      </script>
    </div>
  </body>
</html>
